<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>PHPRestfulSubversion Project Homepage</title>
	
	<style type="text/css">
		body {
  		margin-top: 1.0em;
  		background-color: #f5f5f5;
		  font-family: "Helvetica, Arial, FreeSans", sans-serif;
  		color: #000000;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
		h1 { font-size: 3.8em; color: #424242; margin-bottom: 3px; }
		h1 .small { font-size: 0.4em; }
		h1 a { text-decoration: none }
		h2 { font-size: 1.5em; color: #507428; margin-top: 32px; }
    h3 { text-align: center; color: #00417c; }
    a { color: #002cff; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
		pre { color: #000; }
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
	</style>
	
</head>

<body>

  <div id="container">

    <div class="download">
      <a href="http://github.com/ManuelKiessling/PHPRestfulSubversion/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/ManuelKiessling/PHPRestfulSubversion/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1>PHPRestfulSubversion</h1>

    <div class="description">
      A collection of PHP classes with a REST JSON webservice API which gives you a RESTful access to your Subversion repository.
    </div>


    <h2>Documentation</h2>
    <p>
      Read the detailed <a href="#installation">installation instructions</a>. Installation takes only 10 Minutes and is straightforward.
	  <br />
	  Read the <a href="documentation/api/">API documentation</a> of all PHPRestfulSubversion classes online.
    </p>


    <h2>Download</h2>
    <p>
      You can download this project in either
      <a href="http://github.com/ManuelKiessling/PHPRestfulSubversion/zipball/master">zip</a> or
      <a href="http://github.com/ManuelKiessling/PHPRestfulSubversion/tarball/master">tar</a> formats.
    </p>
    <p>You can also clone the project with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>git clone git://github.com/ManuelKiessling/PHPRestfulSubversion</pre>
    </p>

	<p>
		Browse the project source code on <a href="http://github.com/ManuelKiessling/PHPRestfulSubversion">http://github.com/ManuelKiessling/PHPRestfulSubversion</a>
	</p>

<h2>
About
</h2>

<p>
PHPRestfulSubversion...
</p>

<ol>

<li>

<p>
...provides a RESTful JSON webservice API to access information in your
<br />
  Subversion repository
</p>

</li>

<li>

<p>
...provides tools to cache your Subversion repository in order to make
<br />
  it searchable through the library in a fast and simple manner
</p>

</li>

<li>

<p>
...is a library of PHP classes which you can use to implement more complex
<br />
  use cases
</p>

</li>

</ol>

<h3>
Project Parts
</h3>

<p>
Maybe this stuff makes more sense when being visualized:
</p>

<pre>

<code>
   --------------------
   | Your REST client |
   --------------------
            .
           / \
            |
            |
--------------------------    -----------------------------------------
|     REST webservice    |    | Your PHP tool, using the lib directly |
--------------------------    -----------------------------------------
            .                /
           / \              /
            |              /
            |             /
--------------------------
|                        |     read from SVN ------------------------------
|         Library        |        ------&gt;    |    Cache Builder Script    |
|                        |        &lt;------    ------------------------------
--------------------------     write to cache
      .          .    |
     / \        / \   |
      |          |   \ /
      |          |    .
------------  ------------
| SVN Repo |  | Cache DB |
------------  ------------

</code>

</pre>

<p>
As you can see, PHPRestfulSubversion never writes to the Subversion repository,
<br />
and the REST webservices are read-only as of now.
</p>

<p>
There is a working JavaScript/HTML REST client included which allows you to
<br />
search the Subversion cache for all changesets whose commit message contains
<br />
a certain string, and for all changesets that include a path whose name ends
<br />
on a certain string ("show me all changesets which include the file
<br />
main/default.txt").
</p>

<a name="installation"></a>
<h2>
Installation on Linux systems
</h2>

<p>
Getting PHPRestfulSubversion up and running usually takes around 10 minutes and
<br />
is a process which can roughly be split into four parts:
</p>

<ol>

<li>
Preparing your system
</li>

<li>
Deploy and configure PHPRestfulSubversion
</li>

<li>
Build the Subversion cache
</li>

<li>
Configure Apache to serve the RESTful JSON webservice
</li>

</ol>

<p>
The following process describes the detailed steps necessary for every part
<br />
of the process. The description of this process is targeted at an installation
<br />
on a Debian GNU/Linux 6.0 ("Squeeze") system with at least the "Standard system
<br />
utilities" collection installed.
</p>

<p>
In order to keep things a bit simpler, I assume you do everything as root.
</p>

<h3>
1. Preparing your system
</h3>

<p>
Besides the packages already available on your system and PHPRestfulSubversion
<br />
itself, you will need the following packages:
</p>

<ul>

<li>
Git
</li>

<li>
Subversion
</li>

<li>
SQLite 3
</li>

<li>
PHP 5.3
</li>

<li>
PHPUnit 3
</li>

<li>
Apache 2
</li>

</ul>

<p>
In order to achieve this, you just need to run these commands:
</p>

<pre>

<code>
apt-get update
apt-get install git
apt-get install subversion
apt-get install sqlite3
apt-get install php5-sqlite
apt-get install libapache2-mod-php5
apt-get install phpunit

</code>

</pre>

<h3>
2. Deploy and configure PHPRestfulSubversion
</h3>

<p>
Now we are going to download PHPRestfulSubversion and check if it works:
</p>

<pre>

<code>
cd /opt
git clone git://github.com/ManuelKiessling/PHPRestfulSubversion.git
cd PHPRestfulSubversion/tests
bash ./runall.sh

</code>

</pre>

<p>
This should produce an output similar to
</p>

<pre>

<code>
PHPUnit 3.5.0 by Sebastian Bergmann.

............................................................ 60 / 74
..............

Time: 0 seconds, Memory: 6.25Mb

OK (74 tests, 70 assertions)

</code>

</pre>

<p>
The important thing is that there haven't been any failures, like this:
</p>

<pre>

<code>
FAILURES!
Tests: 91, Assertions: 92, Failures: 1.

</code>

</pre>

<p>
If everything went fine, we can go on to configure our PHPRestfulSubversion
<br />
configuration.
</p>

<p>
Basically, this means to tell PHPRestfulSubversion where your Subversion repository
<br />
is and where your Subversion cache is going to be.
</p>

<p>
Have a look at
<em>
/opt/PHPRestfulSubversion/etc/PHPRestfulSubversion.sample.conf
</em>
 - it looks
<br />
like this:
</p>

<pre>

<code>
$aConfig['sRepoCacheConnectionString'] = 'sqlite:/var/tmp/PHPRestfulSubversion.RepoCache.sqlite';
$aConfig['sRepoLocation'] = '
<a href='http://svn.example.com/'>
http://svn.example.com/
</a>
';
$aConfig['sRepoUsername'] = 'user';
$aConfig['sRepoPassword'] = 'password';
$aConfig['iMaxImportsPerRun'] = 100;

</code>

</pre>

<p>
We are going to copy this example file to
<em>
/opt/PHPRestfulSubversion/etc/PHPRestfulSubversion.conf
</em>

<br />
and fill in real values according to our environment.
</p>

<pre>

<code>
cp /opt/PHPRestfulSubversion/etc/PHPRestfulSubversion.sample.conf /opt/PHPRestfulSubversion/etc/PHPRestfulSubversion.conf
vim /opt/PHPRestfulSubversion/etc/PHPRestfulSubversion.conf

</code>

</pre>

<p>
(You can of course use any text editor you like for editing this file).
</p>

<p>
The first value,
<em>
sRepoCacheConnectionString
</em>
, is probably fine for you as it
<br />
is and you don't have to change it.
</p>

<p>

<em>
sRepoLocation
</em>
 is the full URI to your Subversion repository, and
<br />

<em>
sRepoUsername
</em>
 and
<em>
sRepoPassword
</em>
 are the credentials needed to access this
<br />
repository. PHPRestfulSubversion only needs read access.
</p>

<p>
The buildCache script will stop after importing
<em>
iMaxImportsPerRun
</em>
 revisions.
<br />
If started again, it will continue with the next batch of revisions. It's
<br />
designed that way because some Subversion repositories might be really big,
<br />
and it makes sense to not import the whole repository at once.
</p>

<h3>
3. Build the Subversion cache
</h3>

<p>
Once you've set up this configuration file with real-life values, you can start
<br />
the command line script which reads from your Subversion repository and inserts
<br />
the changesets into the cache database:
</p>

<pre>

<code>
cd /opt/PHPRestfulSubversion/bin
./buildCache.php /opt/PHPRestfulSubversion/etc/PHPRestfulSubversion.conf

</code>

</pre>

<p>
In order to ensure that your repository cache is always in sync with your
<br />
repository cache, create a cronjob which will insert new revisions into the
<br />
cache regularly, like this:
</p>

<pre>

<code>
* * * * *    root    /opt/PHPRestfulSubversion/bin/buildCache.php /opt/PHPRestfulSubversion/etc/PHPRestfulSubversion.conf

</code>

</pre>

<h3>
4. Configure Apache to serve the RESTful JSON webservice
</h3>

<p>
PHPRestfulSubversion allows you to query information about your Subversion
<br />
repository using a RESTful JSON webservice API. In order to serve this API,
<br />
you will need to set up a webserver which will provide access to this API via
<br />
HTTP.
</p>

<p>
Here's how to configure your Apache webserver to make it serve
<br />
PHPRestfulSubversion:
</p>

<p>
I assume you want to make the webservice available at
</p>

<pre>

<code>

<a href='http://localhost:10000/'>
http://localhost:10000/
</a>

</code>

</pre>

<p>
which means you would be able to request information about revision 12345 by
<br />
calling
</p>

<pre>

<code>

<a href='http://localhost:10000/changeset/12345'>
http://localhost:10000/changeset/12345
</a>

</code>

</pre>

<p>
via GET.
</p>

<p>
To achieve this, you need to enable the mod_rewrite Apache module:
</p>

<pre>

<code>
a2enmod rewrite

</code>

</pre>

<p>
Then add the following at the end of
<em>
/etc/apache2/sites-available/default
</em>
:
</p>

<pre>

<code>
# PHPRestfulSubversion REST API
NameVirtualHost 0.0.0.0:10000
Listen 0.0.0.0:10000
&lt;VirtualHost 0.0.0.0:10000&gt;
  DocumentRoot "/opt/PHPRestfulSubversion/public"
  DirectoryIndex index.html
  &lt;Directory "/opt/PHPRestfulSubversion//public"&gt;
    AllowOverride All
    Allow from All
    RewriteEngine On
    RewriteRule !\.(js|ico|gif|jpg|png|css|html)$ ResourceDispatcher.php
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;

</code>

</pre>

<p>
Afterwards, you need to restart your webserver:
</p>

<pre>

<code>
/etc/init.d/apache2 force-reload

</code>

</pre>

<p>
Then you can open the following URL in your browser:
</p>

<pre>

<code>

<a href='http://localhost:10000/changeset/1'>
http://localhost:10000/changeset/1
</a>

</code>

</pre>

<p>
This should return a JSON result set with information about the first revision
<br />
in your repository.
</p>

<p>
PHPRestfulSubversion ships with a demo HTML client for the REST webservice,
<br />
which you can use by pointing your browser at
</p>

<pre>

<code>

<a href='http://localhost:10000/DemoWebserviceClient.html'>
http://localhost:10000/DemoWebserviceClient.html
</a>

</code>

</pre>

<h2>
Using the PHP library
</h2>

<p>
If you want to use the PHP library that works under the hood of,
<br />
PHPRestfulSubversion, here is how to integrate it into your code:
</p>

<pre>

<code>
&lt;?php

require_once '/opt/PHPRestfulSubversion/lib/RestfulSubversion/Helper/Bootstrap.php';

$oRepoCache = new RestfulSubversion_Core_RepoCache(new PDO($sRepoCacheConnectionString, NULL, NULL));
$oChangeset = $oRepoCache-&gt;oGetChangesetForRevision('12345');

echo $oChangeset-&gt;sGetAuthor();

</code>

</pre>

<h2>
Feedback
</h2>

<p>
Any feedback is highly appreciated. You can reach me at
<a href="mailto:manuel@kiessling.net">manuel@kiessling.net</a>
, or open a new issue at
<a href='https://github.com/ManuelKiessling/PHPRestfulSubversion/issues'>
https://github.com/ManuelKiessling/PHPRestfulSubversion/issues
</a>

</p>

</div>

</body>
</html>
